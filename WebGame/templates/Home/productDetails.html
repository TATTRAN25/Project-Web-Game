<!DOCTYPE html>
<html lang="en">
  <head>
    {% load static %}
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet"/>
    <title>Lugx Gaming - Product Detail</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"/>
    <!-- Additional CSS Files -->
    <link rel="stylesheet" href="{% static 'css/fontawesome.css' %}" />
    <link rel="stylesheet" href="{% static 'css/templatemo-lugx-gaming.css' %}"/>
    <link rel="stylesheet" href="{% static 'css/owl.css' %}" />
    <link rel="stylesheet" href="{% static 'css/animate.css' %}" />
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
    <link rel="stylesheet" href="https://unpkg.com/swiper@7/swiper-bundle.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/emoji-mart@latest/dist/browser.js"></script>
  </head>

  <body>
    <!-- ***** Header Area Start ***** -->
    <header class="header-area header-sticky">
      <div class="container">
        <div class="row">
          <div class="col-12">
            <nav class="main-nav">
              <a href="{% url 'Home:index' %}" class="logo">
                <img
                  src="{% static 'images/logo.png' %}"
                  alt="Logo"
                  style="width: 158px"
                />
              </a>
              <ul class="nav">
                <li><a href="{% url 'Home:index' %}">Home</a></li>
                <li><a href="{% url 'Home:game' %}">Our Game</a></li>
                <li><a href="{% url 'Home:contact' %}">Contact Us</a></li>
                {% if user.is_authenticated %}
                <li style="color: white; font-weight: bold">
                  Welcome, {{ user.username }}
                </li>
                <li><a href="{% url 'Home:logout' %}">Logout</a></li>
                {% else %}
                <li style="color: white; font-weight: bold">
                  Welcome User: Guest
                </li>
                <li><a href="{% url 'Home:user_login' %}">Sign In</a></li>
                {% endif %}
              </ul>
              <div class="theme-selector">
                <button id="theme-toggle" title="Toggle Theme">
                    <i class="fas fa-sun" id="theme-icon"></i>
                </button>
              </div>
              <a class="menu-trigger"><span>Menu</span></a>
            </nav>
          </div>
        </div>
      </div>
    </header>
    <!-- ***** Header Area End ***** -->

    <div class="page-heading header-text">
      <div class="container">
        <div class="row">
          <div class="col-lg-12">
            <h3>{{ game.name }}</h3>
            <span class="breadcrumb" style="background-color: transparent">
              <a href="{% url 'Home:index' %}">Home</a>
              <a href="{% url 'Home:game' %}">Our Game</a>
              {{ game.name }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <div class="single-product section">
      <div class="container">
        <div class="row">
          <div class="col-lg-6">
            <div class="left-image">
              {% if game.image %}
              <img src="{{ game.image.url }}" alt="{{ game.name }}" />
              {% else %}
              <img
                src="{% static 'images/default.png' %}"
                alt="No image available"
              />
              {% endif %}
            </div>
          </div>
          <div class="col-lg-6 align-self-center">
            <h4>{{ game.name }}</h4>
            <span class="price">Cracked</span>
            <p>{{ game.description }}</p>

            {% if user.is_authenticated %}
            <a href="{{ game.link_dowload }}" class="btn btn-primary">
              <i class="fas fa-arrow-circle-down"></i> DOWNLOAD NOW!
            </a>
            {% else %}
            <a
              href="{% url 'ProjectWebGame:user_login' %}"
              class="btn btn-secondary"
            >
              You need to log in to download
            </a>
            {% endif %}

            <ul>
              <li><span>Game ID:</span> {{ game.id }}</li>
              <li><span>Studio:</span> {{ game.developer }}</li>
              <li><span>Category:</span> {{ game.category }}</li>
            </ul>
          </div>
          <div class="col-lg-12">
            <div class="sep"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="more-info">
      <div class="container">
        <div class="row">
          <div class="col-lg-12">
            <div class="tabs-content">
              <div class="row">
                <div class="nav-wrapper">
                  <ul class="nav nav-tabs" role="tablist">
                    <li class="nav-item">
                      <button class="nav-link active" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews" type="button" role="tab" aria-controls="reviews" aria-selected="true">Reviews</button>
                    </li>
                  </ul>
                  <div class="tab-content" id="myTabContent">
                    <div class="tab-pane fade show active" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
                      <h5>Leave a Review</h5>
                      <form method="POST" id="commentForm">
                        {% csrf_token %}
                        <div class="input-group" style="position: relative; display: flex; align-items: center;">
                          {{ form.text }}
                          <div class="rating" id="star-rating">
                            <span data-value="1" class="star">&#9733;</span>
                            <span data-value="2" class="star">&#9733;</span>
                            <span data-value="3" class="star">&#9733;</span>
                            <span data-value="4" class="star">&#9733;</span>
                            <span data-value="5" class="star">&#9733;</span>
                          </div>
                          <input type="hidden" name="rating" id="rating-value" value="0">
                          <button id="emoji-button" type="button">😊</button>
                          <div id="emoji-picker" style="display: none;"></div>
                          <span class="input-group-btn">
                            <button type="submit" class="btn btn-primary">Gửi</button>
                          </span>
                        </div>
                      </form>
                      <hr />
                      <h5>Existing Reviews</h5>
                      {% for comment in comments %}
                      <div class="comment">
                        <div class="comment-header">
                          <strong>{{ comment.author.username }}</strong>
                          <span class="comment-date">Posted on: {{ comment.created_date|date:"j F Y" }}</span>
                        </div>
                        <p class="comment-rating">
                          Rating: 
                          {% for i in "12345" %} 
                            {% if forloop.counter <= comment.rating %} ⭐ 
                            {% else %} ☆ 
                            {% endif %} 
                          {% endfor %}
                        </p>
                        <p class="comment-text">{{ comment.text|safe }}</p>

                        <form method="POST" action="{% url 'ProjectWebGame:reply_comment' comment.id %}" class="reply-form">
                          {% csrf_token %}
                          {{ form.text }}  <!-- Trường văn bản để nhập nội dung trả lời -->
                          <button type="submit" class="btn btn-primary">Reply</button>
                        </form>
                      
                        <!-- Hiển thị bình luận trả lời -->
                        <div class="replies">
                            {% for reply in comment.replies.all %}
                                <div class="reply">
                                    <strong>{{ reply.author.username }}</strong>: {{ reply.text }}<br>
                                    <span class="reply-comment-date">Posted on: {{ comment.created_date|date:"j F Y" }}</span>
                                </div>
                            {% empty %}
                                <p>No replies yet.</p>
                            {% endfor %}
                        </div>

                        {% if request.user.is_authenticated %} 
                          {% if request.user.is_staff or request.user == comment.author %}
                            <form method="POST" action="{% url 'ProjectWebGame:delete_comment' comment.id %}" style="display: inline">
                              {% csrf_token %}
                              <button type="submit" class="btn btn-link delete-button" title="Delete comment">
                                <i class="fas fa-trash"></i>
                              </button>
                            </form>
                          {% endif %}
                        {% endif %}
                      </div>
                      <hr />
                      {% empty %}
                      <p>No reviews yet. Be the first to leave a review!</p>
                      {% endfor %}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="section categories related-games">
      <div class="container">
        <div class="row">
          <div class="col-lg-6">
            <div class="section-heading">
              <h6>Action</h6>
              <h2>Related Games</h2>
            </div>
          </div>
          <div class="col-lg-6">
            <div class="main-button">
              <a href="{% url 'Home:game' %}">View All</a>
            </div>
          </div>
        </div>
        <div class="row">
          {% for related_game in related_games %}
          <div class="col-lg-4 col-md-6 col-sm-6 col-xs-12">
            <div class="item">
              <h4>{{ related_game.name }}</h4>
              <div class="thumb">
                <a href="{% url 'Home:productDetails' related_game.id %}">
                  <img
                    src="{{ related_game.image.url }}"
                    alt="{{ related_game.name }}"
                  />
                </a>
              </div>
            </div>
          </div>
          {% empty %}
          <p>No related games found.</p>
          {% endfor %}
        </div>
      </div>
    </div>

    <footer>
      <div class="container">
        <div class="col-lg-12">
          <p>
            Copyright © 2048 LUGX Gaming Company. All rights reserved.
            &nbsp;&nbsp;
            <a rel="nofollow" href="https://templatemo.com" target="_blank"
              >Design: Stolen By ShibaInu</a
            >
          </p>
        </div>
      </div>
    </footer>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <script>
      const textarea = document.querySelector('textarea[name="text"]');
      const button = document.getElementById("emoji-button");

      const picker = new EmojiMart.Picker({
        onEmojiSelect: (emoji) => {
          textarea.value += emoji.native; // Thêm emoji vào textarea
          textarea.focus();
        },
      });

      button.addEventListener("click", () => {
        const emojiPickerDiv = document.getElementById("emoji-picker");
        if (
          emojiPickerDiv.style.display === "none" ||
          emojiPickerDiv.style.display === ""
        ) {
          emojiPickerDiv.style.display = "block";
          emojiPickerDiv.appendChild(picker);
        } else {
          emojiPickerDiv.style.display = "none";
        }
      });

    const stars = document.querySelectorAll('.star');
    const ratingValue = document.getElementById('rating-value');

    function highlightStars(rating) {
      stars.forEach((star, index) => {
        star.style.color = (index < rating) ? 'gold' : 'black';
      });
    }

    stars.forEach((star, index) => {
      star.addEventListener('mouseover', () => {
          highlightStars(index + 1);
      });

      star.addEventListener('mouseout', () => {
          highlightStars(ratingValue.value);
      });

      star.addEventListener('click', () => {
          ratingValue.value = index + 1;
          highlightStars(index + 1);
      });
    });
    highlightStars(0);

    const themeToggleButton = document.getElementById('theme-toggle');
    const themeIcon = document.getElementById('theme-icon');

    function changeTheme(theme) {
      // Xóa các lớp chủ đề hiện tại
      document.body.classList.remove('light-theme', 'dark-theme');
    
      // Thêm lớp chủ đề mới
      document.body.classList.add(theme + '-theme');

      // Thay đổi biểu tượng
      if (theme === 'dark') {
        themeIcon.classList.remove('fa-sun');
        themeIcon.classList.add('fa-moon');
      } else {
        themeIcon.classList.remove('fa-moon');
        themeIcon.classList.add('fa-sun');
      }

      // Lưu chủ đề đã chọn vào localStorage
      localStorage.setItem('theme', theme);
    }

    // Khi trang được tải, kiểm tra localStorage để áp dụng chủ đề đã lưu
    window.onload = function() {
      const savedTheme = localStorage.getItem('theme') || 'light'; // Mặc định là light
      changeTheme(savedTheme);
    };

    // Đặt sự kiện click cho nút đổi chủ đề
    themeToggleButton.addEventListener('click', function() {
      const currentTheme = document.body.classList.contains('dark-theme') ? 'light' : 'dark';
      changeTheme(currentTheme);
    });
    </script>
  </body>
</html>
